<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dashboard Leptospirosis – Pencatatan Kasus</title>
<link rel="stylesheet" href="style.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
<script src="https://unpkg.com/leaflet-image/leaflet-image.js"></script>
</head>
<body>
  <div id="lock" class="lock" style="display:none">
    <div class="lock-card">
      <div class="lock-title">Akses Terbatas</div>
      <div class="lock-sub">Masukkan token untuk membuka dashboard.</div>
      <form id="lockForm" class="lock-row">
        <input id="tokenInput" type="password" placeholder="Masukkan token…" autocomplete="off" />
        <button id="unlockBtn" type="submit" class="btn primary">Masuk</button>
      </form>
      <div id="lockErr" class="lock-err">Token salah. Coba lagi.</div>
    </div>
  </div>

  <header>
    <div class="wrap">
      <div>
        <h1>Dashboard Pencatatan Kasus Leptospirosis</h1>
        <div class="sub">Tema monokrom • Data tersimpan lokal (browser)</div>
      </div>
      <div class="badge neutral" id="defBadge">Definisi Kasus: —</div>
    </div>
  </header>

  <main class="form-column">
    <section id="pasien">
      <h2>Data Pasien</h2>
      <div class="grid-2">
        <div>
          <label>Nama</label>
          <input id="nama" type="text" placeholder="Nama lengkap pasien"/>
        </div>
        <div>
          <label>Jenis Kelamin</label>
          <select id="jk">
            <option value="">Pilih...</option>
            <option>Laki-laki</option>
            <option>Perempuan</option>
          </select>
        </div>
        <div>
          <label>Umur (tahun)</label>
          <input id="umur" type="number" min="0" max="120" placeholder="cth: 34"/>
        </div>
        <div>
          <label>Pekerjaan</label>
          <input id="kerja" type="text" placeholder="cth: Petani"/>
        </div>
        <div>
          <label>Provinsi</label>
          <select id="prov"></select>
        </div>
        <div>
          <label>Kabupaten/Kota</label>
          <select id="kab"></select>
        </div>
      </div>
      <label>Alamat Lengkap</label>
      <textarea id="alamat" placeholder="Tulis alamat lengkap..."></textarea>
    </section>

    <section id="gejala">
      <h2>Riwayat Gejala</h2>
      <div class="muted small">Centang gejala yang muncul. Onset otomatis diambil dari tanggal gejala paling awal.</div>
      <div class="grid-2" id="gejalaGrid"></div>
      <div id="manualOnsetWrap" class="row" style="margin-top:8px">
        <label for="onsetManual" class="muted" style="margin:0">Tanggal onset (manual)</label>
        <input id="onsetManual" type="date" style="margin-left:auto" />
      </div>
      <div class="hr"></div>
      <div class="row">
        <div><span class="muted">Tanggal onset (otomatis)</span></div>
        <div class="tag right" id="onsetTag">—</div>
      </div>
    </section>

    <section id="kontak">
      <h2>Riwayat Kontak</h2>
      <label class="muted">Centang faktor risiko dalam 2 minggu terakhir</label>
      <div class="grid-2" id="paparanGrid"></div>
    </section>

    <section id="lab">
      <h2>Hasil Pemeriksaan Lab</h2>
      <div class="grid-3">
        <div>
          <label>Leukosit (x10³/µL)</label>
          <input id="leukosit" type="number" step="0.1" placeholder="cth: 7.2"/>
        </div>
        <div>
          <label>Trombosit (x10³/µL)</label>
          <input id="trombosit" type="number" step="1" placeholder="cth: 180"/>
        </div>
        <div>
          <label>Bilirubin (mg/dL)</label>
          <input id="bilirubin" type="number" step="0.1" placeholder="cth: 1.8"/>
        </div>
      </div>

      <div class="grid-3" style="margin-top:10px">
        <div>
          <label>RDT</label>
          <div class="row">
            <label class="choice"><input type="radio" name="rdt" value="pos"> Positif</label>
            <label class="choice"><input type="radio" name="rdt" value="neg"> Negatif</label>
            <label class="choice"><input type="radio" name="rdt" value="nd"> Tidak diperiksa</label>
          </div>
        </div>
        <div>
          <label>Hasil MAT</label>
          <div class="row">
            <label class="choice"><input type="radio" name="mat" value="pos"> Positif</label>
            <label class="choice"><input type="radio" name="mat" value="neg"> Negatif</label>
            <label class="choice"><input type="radio" name="mat" value="nd"> Tidak diperiksa</label>
          </div>
        </div>
        <div>
          <label>Serovar</label>
          <input id="serovar" type="text" placeholder="cth: L. icterohaemorrhagiae"/>
        </div>
      </div>
    </section>

    <section id="status">
      <h2>Status Akhir Pasien</h2>
      <div class="grid-3">
        <div>
          <label>Status</label>
          <select id="statusAkhir">
            <option value="">Pilih...</option>
            <option>Sembuh</option>
            <option>Perawatan</option>
            <option>Meninggal</option>
          </select>
        </div>
        <div>
          <label>Tanggal Status</label>
          <input id="tglStatus" type="date"/>
        </div>
        <div>
          <label>Pemberian Obat</label>
          <input id="obat" type="text" placeholder="cth: Doksisiklin"/>
        </div>
      </div>
    </section>

    <section id="aksi">
      <div class="row">
        <button class="btn primary" id="simpan">Simpan Kasus</button>
        <button class="btn" id="cancelEdit">Batal Edit</button>
        <button class="btn warning" id="reset">Reset Form</button>
        <span class="right"></span>
        <button class="btn ok" id="exportExcel">Ekspor Excel</button>
      </div>
    </section>

    <section id="tabel">
      <h2>Data Kasus Tersimpan</h2>
      <div class="case-counts">
        <span id="counts"></span>
        <span id="cfrDisplay" class="tag"></span>
      </div>
      <div class="hr"></div>
      <div style="overflow:auto; margin-top:10px">
        <table class="table" id="casesTable">
          <thead>
            <tr>
              <th>Nama</th>
              <th>Umur</th>
              <th>Jenis Kelamin</th>
              <th>Onset</th>
              <th>Status</th>
              <th>Definisi</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section id="peta">
      <h2>Sebaran Kasus per Provinsi</h2>
      <div class="row" style="margin-top:12px">
        <button id="recalcMap" class="btn">Hitung dari Data</button>
        <button id="exportPng" class="btn">Export PNG</button>
      </div>
      <div id="map"></div>
      <div id="mapMsg" class="muted" style="margin-top:8px"></div>
    </section>
  </main>

  <script src="script.js"></script>
</body>
</html>
